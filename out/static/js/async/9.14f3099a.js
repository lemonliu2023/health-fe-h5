"use strict";(self.webpackChunkh5=self.webpackChunkh5||[]).push([["9"],{569:function(e,t,r){r.r(t),r.d(t,{default:()=>y});var n=r(2676),i=r(4456),l=r(5221),s=r(3647),a=r(5271),c=r(7572),o=r(8706),d=r(6168),u=r(9768);let h="",f=!1;function x(e){let t=e[23],r=e[24],n=e[25],i=e[26],l=e[27],s=e[28],a=m(t,n,l),c=m(r,i,s);return{leftKneeAngle:a,rightKneeAngle:c,leftKnee:n,rightKnee:i,leftAnkle:l,rightAnkle:s,leftHip:t,rightHip:r,kneeAvgAngle:(a+c)/2}}function m(e,t,r){let n={x:e.x-t.x,y:e.y-t.y},i={x:r.x-t.x,y:r.y-t.y},l=n.x*i.x+n.y*i.y;return 180/Math.PI*Math.acos(l/(Math.hypot(n.x,n.y)*Math.hypot(i.x,i.y)))}let g=["./4265287-uhd_3840_2160_30fps.mp4","./2785531-uhd_2160_3840_25fps.mp4","./8836896-uhd_4096_2160_25fps.mp4","./youTube_video.mp4"],p=0,w=function(e){let{width:t,height:r,poseRef:i}=e,[l,s]=(0,a.useState)(!1),c=(0,a.useRef)(null),m=(0,a.useRef)(null),w=(0,a.useRef)(null),[y,v]=(0,a.useState)(0),j=(0,a.useRef)("standing"),k=(0,a.useRef)("undefined"!=typeof Audio?new Audio(`${location.href}/silent_1s.mp3`):void 0);(0,a.useEffect)(()=>{m.current&&(w.current=m.current.getContext("2d"),w.current||console.error("Failed to get canvas context"))},[]);let b=(0,a.useCallback)(()=>{let e,n;if(!c.current||!m.current)return;let i=c.current.videoWidth/c.current.videoHeight,l=t/r;i&&l&&(i>l?(e=t,n=t/i):(n=r,e=r*i),m.current.style.width=`${e}px`,m.current.style.height=`${n}px`,m.current.width=e,m.current.height=n)},[t,r]);(0,a.useEffect)(()=>{b()},[b]);let C=e=>{c.current&&("string"==typeof e?c.current.src=e:c.current.srcObject=e,c.current.addEventListener("loadedmetadata",function(){if(m.current){var e,t;m.current.width=(null==(e=c.current)?void 0:e.videoWidth)||0,m.current.height=(null==(t=c.current)?void 0:t.videoHeight)||0,b()}})),f=!0,S(),s(!0);let t=k.current;null==t||t.play().then(()=>{t.pause(),t.currentTime=0,k.current=new Audio(`${location.href}/mario-coin.wav`)})},N=e=>{C(e)},S=async()=>{var e;async function t(){if(c.current&&f){if(c.current.readyState>=2){var e;null==(e=i.current)||e.send({image:c.current})}requestAnimationFrame(t)}}null==(e=i.current)||e.onResults(_),t()},_=e=>{let t=w.current,r=c.current,n=m.current;t&&r&&n&&(t.save(),t.clearRect(0,0,n.width,n.height),t.translate(n.width,0),t.scale(-1,1),t.drawImage(r,0,0,n.width,n.height),t.restore(),e.poseLandmarks&&e.poseLandmarks.length>0&&(M(e.poseLandmarks),L(e.poseLandmarks)))},M=e=>{let t=w.current,r=m.current;if(!t||!r)return;for(let n of(t.fillStyle="red",t.strokeStyle="green",t.lineWidth=2,u.POSE_CONNECTIONS)){let i=e[n[0]],l=e[n[1]];E(i)&&E(l)&&(t.beginPath(),t.moveTo((1-i.x)*r.width,i.y*r.height),t.lineTo((1-l.x)*r.width,l.y*r.height),t.stroke())}for(let n of e)E(n)&&(t.beginPath(),t.arc((1-n.x)*r.width,n.y*r.height,2,0,2*Math.PI),t.fill());let{leftKneeAngle:n,leftKnee:i,rightKneeAngle:l,rightKnee:s}=x(e);E(i)&&(t.font="24px Arial",t.fillStyle="white",t.fillText(`${Math.round(n)}\xb0`,(1-i.x)*r.width+10,i.y*r.height-10)),E(s)&&(t.font="24px Arial",t.fillStyle="white",t.fillText(`${Math.round(l)}\xb0`,(1-s.x)*r.width+10,s.y*r.height-10))},T=()=>{let e=k.current;v(e=>e+1),null==e||e.play().catch(e=>console.error("音效播放失败:",e))},E=e=>!(e.visibility<.5)&&e.x>=0&&e.x<=1&&e.y>=0&&e.y<=1,L=e=>{let{kneeAvgAngle:t,leftAnkle:r,leftHip:n,leftKnee:i,rightAnkle:l,rightKnee:s,rightHip:a}=x(e);if(!E(i)||!E(r)||!E(n)||!E(s)||!E(l)||!E(a)){let e="请露出膝盖和脚踝";e!==h&&(o.f7.toast.show({text:e,position:"center",closeTimeout:2e3}),setTimeout(()=>{h=""},2e3),h=e);return}t<120&&"standing"===j.current&&(j.current="squatting",p=performance.now()),t>160&&"squatting"===j.current&&(j.current="standing",performance.now()-p<2e3&&T())};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"relative bg-[#000]",style:{width:t,height:r-44,display:l?"block":"none",overflow:"hidden"},children:[(0,n.jsxs)("div",{id:"render-wrapper",className:"flex justify-center items-center",children:[(0,n.jsx)("video",{className:"fixed bottom-0 left-0 w-40",ref:c,autoPlay:!0,playsInline:!0,loop:!0,controls:!0}),(0,n.jsx)("canvas",{ref:m,width:t,height:r-44})]}),(0,n.jsxs)("div",{id:"counter",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},className:"fixed top-12 left-1 text-[#fff] p-[10px] rounded-[10px]",onClick:()=>{var e;null==(e=k.current)||e.play().catch(e=>console.error("音效播放失败:",e))},children:["深蹲次数: ",y]}),(0,n.jsx)("div",{className:"fixed left-1/2 bottom-10 -translate-x-1/2",children:(0,n.jsx)(d.Z,{large:!0,fill:!0,onClick:()=>{s(!1),f=!1,c.current&&c.current.pause(),v(0)},children:"结束训练"})})]}),(0,n.jsxs)("div",{style:{display:l?"none":"flex"},className:"flex-col items-center p-2 pt-4",children:[(0,n.jsx)("div",{className:"w-40 mb-4",children:(0,n.jsx)(d.Z,{large:!0,fill:!0,onClick:()=>{new Promise(e=>{navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:1280},height:{ideal:720}},audio:!1}).then(t=>e(t))}).then(e=>{C(e)}).catch(e=>{console.error("Camera error:",e)})},children:"开始自主训练"})}),g.map((e,t)=>(0,n.jsx)("video",{onClick:()=>N(e),className:"w-full h-auto mb-4",src:`${e}#t=0.001`,playsInline:!0,muted:!0},t))]})]})},y=function(){let[e,t]=(0,a.useState)(!0),o=(0,a.useRef)(),[d,h]=(0,a.useState)({width:0,height:0}),[f,x,m]=(0,c.q)(8e3);return(0,a.useEffect)(()=>{r.e("79").then(r.t.bind(r,8790,23)).then(e=>{new e.default});let e=()=>{h({width:window.innerWidth,height:window.innerHeight})};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),(0,a.useEffect)(()=>{t(!0),x(),o.current=new u.Pose({locateFile:e=>(console.log(e,"file"),`${window.location.href}/${e}`)}),o.current.setOptions({modelComplexity:1,smoothLandmarks:!0,enableSegmentation:!1,smoothSegmentation:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),o.current.initialize().then(()=>{t(!1),m()})},[]),(0,n.jsxs)(i.Z,{children:[(0,n.jsx)(l.Z,{title:"深蹲训练",backLink:" "}),(0,n.jsx)("div",{className:"grid place-items-center h-full",children:(0,n.jsx)("div",{className:"m-auto",children:e?(0,n.jsxs)("div",{className:"w-screen px-10",children:[(0,n.jsx)("div",{className:"my-2 text-center",children:"模型加载中..."}),(0,n.jsx)(s.Z,{progress:100*f})]}):(0,n.jsx)(w,{width:d.width,height:d.height,poseRef:o})})})]})}}}]);